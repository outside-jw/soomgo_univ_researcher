"""
ì§ˆë¬¸ ë±…í¬ (Question Bank)

scaffolding.mdì—ì„œ ì¶”ì¶œí•œ ëª¨ë“  ì˜ˆì‹œ ì§ˆë¬¸ë“¤ì„ CPS ë‹¨ê³„ì™€ ë©”íƒ€ì¸ì§€ ìš”ì†Œë³„ë¡œ êµ¬ì¡°í™”
ê° ì§ˆë¬¸ì€ ì‹¤ì œ ì‚¬ìš© ì‹œ ê·¸ëŒ€ë¡œ ì œê³µë˜ì–´ì•¼ í•¨ (Geminiê°€ ìƒˆë¡œ ìƒì„±í•˜ì§€ ì•ŠìŒ)
"""

QUESTION_BANK = {
    # ë„ì „(ë¬¸ì œ) ì´í•´ ë‹¨ê³„
    "ë„ì „_ì´í•´": {
        # ğŸŒŸ í•µì‹¬ ì¸ì§€ ê³¼ì • ì§ˆë¬¸ (ê° ë‹¨ê³„ ì‹œì‘ ì‹œ ìš°ì„  ì‚¬ìš©)
        "í•µì‹¬_ì¸ì§€_ê³¼ì •": [
            "í˜„ì¬ ë¬¸ì œ ì†ì—ì„œ ì–´ë–¤ ìš”ì¸ë“¤ì´ ì„œë¡œ ì˜í–¥ì„ ì£¼ê³ ë°›ê³  ìˆë‚˜ìš”?",
            "í•´ë‹¹ ë¬¸ì œë¥¼ í•œ ë¬¸ì¥ìœ¼ë¡œ ì •ì˜í•œë‹¤ë©´ ì–´ë–»ê²Œ í‘œí˜„í•  ìˆ˜ ìˆì„ê¹Œìš”?",
            "í•´ë‹¹ ë¬¸ì œë¥¼ ë™ë£Œêµì‚¬ë‚˜ í•™ìƒì˜ ê´€ì ì—ì„œ ë°”ë¼ë³¸ë‹¤ë©´ ì–´ë–¤ ì ì´ ë‹¤ë¥´ê²Œ ë³´ì¼ê¹Œìš”?",
        ],
        "ì¡°ì ˆ": [
            "í•´ë‹¹ ë¬¸ì œì™€ ì˜ˆì‹œë¥¼ ì¶©ë¶„íˆ ì´í•´í–ˆë‹¤ê³  ìƒê°í•˜ë‚˜ìš”?",
            "ë¬¸ì œ í•´ê²°ì„ ìœ„í•´ ì œì‹œë¬¸ ë° ì˜ˆì‹œë¥¼ ë” ìì„¸íˆ ê²€í† í•´ ë³¼ê¹Œìš”?",
        ],
        "ì ê²€": [
            "í•´ë‹¹ ë¬¸ì œê°€ ì–¼ë§ˆë‚˜ ìµìˆ™í•˜ê²Œ ëŠê»´ì§€ë‚˜ìš”? ê·¸ ì´ìœ ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
            "í•´ë‹¹ ë¬¸ì œì˜ ë‚œì´ë„ëŠ” ì–´ëŠ ì •ë„ë¼ê³  íŒë‹¨ë˜ë‚˜ìš”? ê·¸ ì´ìœ ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
            "í•´ë‹¹ ë¬¸ì œë¥¼ ì–¼ë§ˆë‚˜ ì˜ í•´ê²°í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ë‚˜ìš”?",
            "ë¬¸ì œì—ì„œ ê°€ì¥ ì–´ë ¤ìš´ ë¶€ë¶„ì€ ë¬´ì—‡ì¸ê°€ìš”? ê·¸ë ‡ê²Œ ìƒê°í•œ ì´ìœ ë¥¼ ë§ì”€í•´ì£¼ì„¸ìš”.",
            "ë¬¸ì œì—ì„œ ì–´ë–¤ ë¶€ë¶„ì´ íŠ¹íˆ ë” ë§ì€ ì¤€ë¹„ë‚˜ ì§€ì›ì„ í•„ìš”ë¡œ í•  ê²ƒ ê°™ë‚˜ìš”?",
            "í˜„ì¬ í•´ë‹¹ ë¬¸ì œë¥¼ ì–¼ë§ˆë‚˜ ì„±ê³µì ìœ¼ë¡œ í•´ê²°í•  ìˆ˜ ìˆì„ ê²ƒ ê°™ë‚˜ìš”?",
        ],
        "ì§€ì‹": [
            "ì´ì „ì— ë¹„ìŠ·í•œ ë¬¸ì œë¥¼ í•´ê²°í•´ ë³¸ ê²½í—˜ì´ ìˆë‚˜ìš”? ì–´ë–¤ í•´ê²°ì±…ì´ íš¨ê³¼ì ì´ì—ˆë‚˜ìš”?",
        ],
    },

    # ì•„ì´ë””ì–´ ìƒì„± ë‹¨ê³„
    "ì•„ì´ë””ì–´_ìƒì„±": {
        # ğŸŒŸ í•µì‹¬ ì¸ì§€ ê³¼ì • ì§ˆë¬¸ (ê° ë‹¨ê³„ ì‹œì‘ ì‹œ ìš°ì„  ì‚¬ìš©)
        "í•µì‹¬_ì¸ì§€_ê³¼ì •": [
            "ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆëŠ” ëª¨ë“  ì•„ì´ë””ì–´ë¥¼ ììœ ë¡­ê²Œ ë– ì˜¬ë ¤ë³¼ê¹Œìš”?",
            "í•´ë‹¹ ì•„ì´ë””ì–´ë¥¼ ì œì‹œí•œ ì´ìœ ë‚˜ ê·¼ê±°ëŠ” ë¬´ì—‡ì¸ê°€ìš”?",
            "ì§€ê¸ˆ ë– ì˜¬ë¦° ì•„ì´ë””ì–´ì˜ ê¸°ëŒ€ë˜ëŠ” íš¨ê³¼ë‚˜ í•œê³„ë¥¼ ì„¤ëª…í•´ë³¼ê¹Œìš”?",
        ],
        "ì¡°ì ˆ": [
            "ì§€ê¸ˆ ë– ì˜¬ë¦° ì•„ì´ë””ì–´ë¥¼ ë” ë°œì „ì‹œí‚¬ ìˆ˜ ìˆì„ê¹Œìš”?",
            "í˜„ì¬ ì•„ì´ë””ì–´ê°€ ì˜ ë– ì˜¤ë¥´ì§€ ì•ŠëŠ”ë‹¤ë©´, ì•„ì´ë””ì–´ ìƒì„± ì „ëµì„ ë°”ê¿”ë³¼ê¹Œìš”?",
        ],
        "ì ê²€": [
            "ì´ ì•„ì´ë””ì–´ëŠ” ë¬¸ì œ í•´ê²° ëª©í‘œ ë‹¬ì„±ì— ì–¼ë§ˆë‚˜ ë¶€í•©í•˜ë‚˜ìš”?",
            "í˜„ì¬ ì•„ì´ë””ì–´ ìˆ˜ì™€ ë‹¤ì–‘ì„±ì€ ì¶©ë¶„í•˜ë‹¤ê³  ëŠë¼ì‹œë‚˜ìš”?",
            "ê¸°ì¡´ ì•„ì´ë””ì–´ì™€ ë¹„êµí–ˆì„ ë•Œ, ì´ ì•„ì´ë””ì–´ì˜ ê°•ì ì€ ë¬´ì—‡ì¸ê°€ìš”?",
            "ì œì‹œí•œ ì•„ì´ë””ì–´ëŠ” ìƒˆë¡œìš´ ë™ì‹œì— íš¨ê³¼ì ì¸ê°€ìš”?",
            "ì œì‹œí•œ ì•„ì´ë””ì–´ê°€ ë¬¸ì œ í•´ê²° ë‹¬ì„±ì— ì–¼ë§ˆë‚˜ ë¶€í•©í•˜ë‚˜ìš”?",
            "ì§€ê¸ˆê¹Œì§€ ë– ì˜¬ë¦° ì•„ì´ë””ì–´ ìˆ˜ë‚˜ ë‹¤ì–‘ì„±ì´ ì¶©ë¶„í•˜ë‹¤ê³  ìƒê°í•˜ì‹œë‚˜ìš”?",
            "ë‹¤ë¥¸ ì•„ì´ë””ì–´ì™€ ë¹„êµí–ˆì„ ë•Œ, ì´ ì•„ì´ë””ì–´ë§Œì˜ ê°•ì ì€ ë¬´ì—‡ì¸ê°€ìš”?",
        ],
        "ì§€ì‹": [
            "í•´ë‹¹ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•œ ì•„ì´ë””ì–´ ìƒì„± ì „ëµ(ì˜ˆ: ë¸Œë ˆì¸ìŠ¤í† ë°)ìœ¼ë¡œ ì–´ë–¤ ê²ƒë“¤ì´ ìˆì„ê¹Œìš”? ê°€ì¥ íš¨ê³¼ì ì´ë¼ê³  íŒë‹¨ë˜ëŠ” ì „ëµì„ ì„ íƒí•´ ì•„ì´ë””ì–´ë¥¼ ìƒì„±í•´ë³¼ê¹Œìš”?",
        ],
    },

    # ì‹¤í–‰ ì¤€ë¹„ ë‹¨ê³„
    "ì‹¤í–‰_ì¤€ë¹„": {
        # ğŸŒŸ í•µì‹¬ ì¸ì§€ ê³¼ì • ì§ˆë¬¸ (ê° ë‹¨ê³„ ì‹œì‘ ì‹œ ìš°ì„  ì‚¬ìš©)
        "í•µì‹¬_ì¸ì§€_ê³¼ì •": [
            "ì´ ì•„ì´ë””ì–´ë¥¼ ì‹¤ì œë¡œ í˜„ì¥ì—ì„œ ì‹¤í–‰í•œë‹¤ë©´ ì–´ë–¤ ê²°ê³¼ë‚˜ ë³€í™”ê°€ ë°œìƒí• ê¹Œìš”?",
            "ì•„ì´ë””ì–´ ì‹¤í–‰ ê³¼ì •ì—ì„œ ì˜ˆìƒë˜ëŠ” ì–´ë ¤ì›€ê³¼ í•´ê²°ë°©ì•ˆì„ ê³„íší•´ë³¼ê¹Œìš”?",
        ],
        "ì¡°ì ˆ": [
            "ì§€ê¸ˆê¹Œì§€ ì œì‹œí•œ ì•„ì´ë””ì–´ë“¤ì„ ë¹„êµí•´ë³´ê³ , ê°€ì¥ ì°½ì˜ì ì´ë©´ì„œ ì‹¤í–‰ ê°€ëŠ¥í•œ ì•„ì´ë””ì–´ë¥¼ ê³¨ë¼ë³¼ê¹Œìš”?",
        ],
        "ì ê²€": [
            "ë„ì¶œëœ ì•„ì´ë””ì–´ë“¤ì„ ì°½ì˜ì„±ê³¼ ì‹¤í–‰ ê°€ëŠ¥ì„± ê´€ì ì—ì„œ í‰ê°€í•´ë³¼ê¹Œìš”?",
            "ë¬¸ì œ í•´ê²° ê³¼ì •ì„ ëŒì•„ë´¤ì„ ë•Œ, ì•„ì´ë””ì–´ ìƒì„±ì„ ìœ„í•´ íš¨ê³¼ì ì´ì—ˆë˜ ì „ëµê³¼ ê·¸ë ‡ì§€ ëª»í–ˆë˜ ì „ëµì€ ë¬´ì—‡ì¸ê°€ìš”?",
        ],
        "ì§€ì‹": [
            "ì´ë²ˆ ë¬¸ì œ í•´ê²°ì„ í†µí•´ ìƒˆë¡­ê²Œ ë°°ìš´ ì ì€ ë¬´ì—‡ì¸ê°€ìš”? ì•ìœ¼ë¡œ ë¹„ìŠ·í•œ ë¬¸ì œë¥¼ í•´ê²°í•  ë•Œ ì´ ê²½í—˜ì„ ì–´ë–»ê²Œ í™œìš©í•  ìˆ˜ ìˆì„ê¹Œìš”?",
            "ì´ë²ˆ ë¬¸ì œ í•´ê²°ì„ ìˆ˜í–‰í•˜ë©° ìì‹ ì˜ ì‚¬ê³ ë‚˜ ì „ëµì— ëŒ€í•´ ìƒˆë¡­ê²Œ ì•Œê²Œ ëœ ì ì´ ìˆë‚˜ìš”?",
        ],
    },
}


def get_question(stage: str, metacog_element: str, index: int = 0) -> str:
    """
    íŠ¹ì • CPS ë‹¨ê³„ì™€ ë©”íƒ€ì¸ì§€ ìš”ì†Œì— í•´ë‹¹í•˜ëŠ” ì§ˆë¬¸ì„ ë°˜í™˜

    Args:
        stage: CPS ë‹¨ê³„ ("ë„ì „_ì´í•´", "ì•„ì´ë””ì–´_ìƒì„±", "ì‹¤í–‰_ì¤€ë¹„")
        metacog_element: ë©”íƒ€ì¸ì§€ ìš”ì†Œ ("ì ê²€", "ì¡°ì ˆ", "ì§€ì‹")
        index: ì§ˆë¬¸ ì¸ë±ìŠ¤ (ê¸°ë³¸ê°’: 0, ì²« ë²ˆì§¸ ì§ˆë¬¸)

    Returns:
        í•´ë‹¹í•˜ëŠ” ì§ˆë¬¸ ë¬¸ìì—´, ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´
    """
    try:
        questions = QUESTION_BANK.get(stage, {}).get(metacog_element, [])
        if questions and 0 <= index < len(questions):
            return questions[index]
        return ""
    except Exception:
        return ""


def get_all_questions(stage: str, metacog_element: str) -> list[str]:
    """
    íŠ¹ì • CPS ë‹¨ê³„ì™€ ë©”íƒ€ì¸ì§€ ìš”ì†Œì— í•´ë‹¹í•˜ëŠ” ëª¨ë“  ì§ˆë¬¸ì„ ë°˜í™˜

    Args:
        stage: CPS ë‹¨ê³„ ("ë„ì „_ì´í•´", "ì•„ì´ë””ì–´_ìƒì„±", "ì‹¤í–‰_ì¤€ë¹„")
        metacog_element: ë©”íƒ€ì¸ì§€ ìš”ì†Œ ("ì ê²€", "ì¡°ì ˆ", "ì§€ì‹")

    Returns:
        ì§ˆë¬¸ ë¬¸ìì—´ ë¦¬ìŠ¤íŠ¸
    """
    return QUESTION_BANK.get(stage, {}).get(metacog_element, [])


def get_random_question(stage: str, metacog_element: str) -> str:
    """
    íŠ¹ì • CPS ë‹¨ê³„ì™€ ë©”íƒ€ì¸ì§€ ìš”ì†Œì— í•´ë‹¹í•˜ëŠ” ì§ˆë¬¸ì„ ëœë¤ìœ¼ë¡œ ì„ íƒí•˜ì—¬ ë°˜í™˜

    Args:
        stage: CPS ë‹¨ê³„ ("ë„ì „_ì´í•´", "ì•„ì´ë””ì–´_ìƒì„±", "ì‹¤í–‰_ì¤€ë¹„")
        metacog_element: ë©”íƒ€ì¸ì§€ ìš”ì†Œ ("ì ê²€", "ì¡°ì ˆ", "ì§€ì‹")

    Returns:
        ëœë¤ìœ¼ë¡œ ì„ íƒëœ ì§ˆë¬¸ ë¬¸ìì—´, ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´
    """
    import random
    questions = get_all_questions(stage, metacog_element)
    return random.choice(questions) if questions else ""


def format_questions_for_prompt(stage: str) -> str:
    """
    íŠ¹ì • CPS ë‹¨ê³„ì˜ ëª¨ë“  ì§ˆë¬¸ì„ ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ìš©ìœ¼ë¡œ í¬ë§·íŒ…

    Args:
        stage: CPS ë‹¨ê³„ ("ë„ì „_ì´í•´", "ì•„ì´ë””ì–´_ìƒì„±", "ì‹¤í–‰_ì¤€ë¹„")

    Returns:
        í¬ë§·íŒ…ëœ ì§ˆë¬¸ ëª©ë¡ ë¬¸ìì—´
    """
    if stage not in QUESTION_BANK:
        return ""

    formatted = []
    stage_data = QUESTION_BANK[stage]

    for metacog in ["ì ê²€", "ì¡°ì ˆ", "ì§€ì‹"]:
        if metacog in stage_data and stage_data[metacog]:
            formatted.append(f"\n{metacog}:")
            for i, question in enumerate(stage_data[metacog], 1):
                formatted.append(f"  {i}. {question}")

    return "\n".join(formatted)
